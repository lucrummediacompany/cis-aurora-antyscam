<!DOCTYPE html>
<html lang="pl">
<head>
  <!-- Outseta embed (auth + profile + nocode widgets) -->
  <script>
    var o_options = {
      domain: 'lucrum-media-company-spolka-z-ograniczona-odpowiedzialnoscia.outseta.com',
      load: 'auth,customForm,emailList,leadCapture,nocode,profile,support'
    };
  </script>
  <script src="https://cdn.outseta.com/outseta.min.js" data-options="o_options"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CIS Aurora ‚Äî AntyScam (Local)</title>

  <style>
    :root { color-scheme: dark; }
    body {
      font-family: Arial, sans-serif;
      margin: 32px;
      background: #0e0f13;
      color: #e6e7ea;
    }
    .wrap { max-width: 900px; margin: auto; }
    h1 { margin-bottom: 8px; }

    .btn {
      background: #1f2937;
      color: #e6e7ea;
      border: 1px solid #334155;
      border-radius: 8px;
      padding: 8px 12px;
      cursor: pointer;
      transition: transform .05s ease, background .2s;
    }
    .btn:hover { background: #243244; }
    .btn:active { transform: translateY(1px); }

    .row { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }

    .stripe-note {
      display: inline-block;
      margin: 12px 0 18px 0;
      padding: 8px 12px;
      border: 1px dashed #334155;
      border-radius: 8px;
      background: #0f172a;
      color: #b9c2d0;
      font-size: 0.95rem;
    }
  /* Dynamic billing badges */
  .stripe-note.badge--trial{background:rgba(255,200,0,.08);color:#ffd479;border-color:rgba(255,200,0,.25);}
  .stripe-note.badge--active{background:rgba(0,200,140,.08);color:#73f3cc;border-color:rgba(0,200,140,.25);}
    .card {
      border: 1px solid #1f2937;
      background: #0f1623;
      border-radius: 12px;
      padding: 14px;
    }
    .card h3 { margin: 0 0 10px 0; }

    .input {
      width: 100%;
      background: #0c1320;
      color: #e6e7ea;
      border: 1px solid #243244;
      border-radius: 10px;
      padding: 10px 12px;
      outline: none;
    }
    .input:focus { border-color: #3b82f6; }

    .pill {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 9999px;
      font-weight: 700;
      font-size: 0.85rem;
    }
    .pill.good { background: #0b2f27; color: #81f2d2; border: 1px solid #184e42; }
    .pill.risk { background: #2f210b; color: #f2c681; border: 1px solid #5a4117; }
    .pill.bad { background: #2f0b0b; color: #f28181; border: 1px solid #5a1717; }

    .grid { display: grid; gap: 12px; }
    @media (min-width: 900px) { .grid-cols-2 { grid-template-columns: 1fr 1fr; } }

    .muted { color: #9aa6b2; font-size: .95rem; }
    .badge {
      display: inline-flex; align-items: center; gap: 8px;
      padding: 3px 10px; border-radius: 999px; font-size: .85rem; border: 1px solid #334155;
      background: #0b1220; color: #bcd0ea;
    }
    .sep { height: 10px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>üß† CIS Aurora ‚Äî AntyScam (Local)</h1>
    <div class="muted">Wklej adres kontraktu ETH, uruchom analizƒô i zobacz wynik. Serwer: Flask (port 5000).</div>

    <div class="sep"></div>

    <div class="row">
      <button class="btn" id="btnProfile">Profil</button>
      <button class="btn" id="btnLogout">Wyloguj</button>
    </div>

    <!-- Pasek statusu p≈Çatno≈õci (dynamiczny, fallback na ‚ÄûStripe‚Äù) -->
    <div class="stripe-note" id="billingBadge" title="Status p≈Çatno≈õci">P≈Çatno≈õci obs≈Çuguje <b>Stripe</b>.</div>

    <div class="card" style="margin-top: 6px;">
      <label for="address" class="muted">Adres kontraktu (0x...):</label>
      <input id="address" class="input" placeholder="0x0000000000000000000000000000000000000000"/>
      <div class="sep"></div>
      <div class="row">
        <button id="analyzeBtn" class="btn">Analizuj</button>
        <button id="lastBtn" class="btn">Poka≈º ostatni raport</button>
      </div>
    </div>

    <div class="sep"></div>

    <div id="result" class="card">
      <h3>Wynik</h3>
      <pre id="resultBox" class="muted">Brak raport√≥w.</pre>
    </div>

    <div class="sep"></div>

    <div class="grid grid-cols-2">
      <div class="card">
        <div class="pill good">GOOD</div> TokenMintERC20Token
        <div class="muted">Adres: 0x95ad61b0a15e0d79219dcf64e1c6ec01f8cb4c4ce</div>
        <div class="muted">Wynik: <b>8.80 / 10</b></div>
      </div>
      <div class="card">
        <h3 class="muted">üìù Co analizujemy (sta≈Çe obszary audytu)</h3>
        <ul class="muted" style="margin: 6px 0 0 14px;">
          <li>Wysokie podatki</li>
          <li>Pu≈Çapki na kupujƒÖcych</li>
          <li>Mo≈ºliwo≈õƒá nieograniczonego dodruku</li>
          <li>Ca≈Ça poda≈º do jednego adresu na starcie</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
    // UI handlers (Outseta widgets)
    const btnProfile = document.getElementById('btnProfile');
    const btnLogout  = document.getElementById('btnLogout');
    btnProfile?.addEventListener('click', () => {
      try { Outseta.nocode.profile.open(); } catch(e) { console.warn(e); }
    });
    btnLogout?.addEventListener('click', async () => {
      try { await Outseta.auth.signOut(); location.reload(); } catch(e) { console.warn(e); }
    });

    // Demo analyze / last-report hooks (pozostawione bez zmian)
    const addr = document.getElementById('address');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const lastBtn = document.getElementById('lastBtn');
    const out = document.getElementById('resultBox');

    analyzeBtn?.addEventListener('click', async () => {
      out.textContent = '‚è≥ Analiza w toku‚Ä¶';
      try {
        const r = await fetch('/analyze?address=' + encodeURIComponent(addr.value || ''));
        out.textContent = await r.text();
      } catch (e) {
        out.textContent = 'TypeError: NetworkError when attempting to fetch resource.';
      }
    });

    lastBtn?.addEventListener('click', async () => {
      try {
        const r = await fetch('/last-report');
        out.textContent = await r.text();
      } catch (e) {
        out.textContent = 'Brak raport√≥w.';
      }
    });
  </script>

  <script>
    // Dynamic Outseta billing badge (safe, optional)
    (function(){
      var badge = document.getElementById('billingBadge');
      function setBadge(state){
        if(!badge) return;
        badge.classList.remove('badge--trial','badge--active');
        if(state==='trial'){
          badge.innerHTML = 'Plan: <b>TRIAL</b> (okres pr√≥bny)';
          badge.classList.add('badge--trial');
        } else if(state==='active'){
          badge.innerHTML = 'Plan: <b>ACTIVE</b>';
          badge.classList.add('badge--active');
        } else {
          badge.innerHTML = 'P≈Çatno≈õci obs≈Çuguje <b>Stripe</b>.';
        }
      }
      try{
        if(window.Outseta && typeof window.Outseta.on==='function'){
          window.Outseta.on('ready', function(){
            // Spr√≥buj pobraƒá listƒô subskrypcji (u zalogowanego u≈ºytkownika). W razie b≈Çƒôdu ‚Äì fallback do Stripe.
            var getter = (window.Outseta.get ? window.Outseta.get : null);
            if(!getter){ setBadge(null); return; }
            getter('billing/subscriptions').then(function(resp){
              var list = (resp && (resp.items || resp.data)) || resp || [];
              var state = null;
              for(var i=0;i<list.length;i++){
                var s = list[i] || {};
                var status = String(s.status || s.SubscriptionStatus || '').toLowerCase();
                var trialEnd = s.trial_ends_at || s.trialEndsAt;
                if(status.indexOf('trial')>-1 || (trialEnd && new Date(trialEnd) > new Date())){ state='trial'; break; }
                if(status.indexOf('active')>-1){ state='active'; break; }
              }
              setBadge(state);
            }).catch(function(){ setBadge(null); });
          });
        }
      }catch(e){ /* ignore */ }
    })();
  </script>
</body>
</html>
