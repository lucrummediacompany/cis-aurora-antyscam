<!DOCTYPE html>
<html lang="pl">
<head>
<script>
  var o_options = {
    domain: 'lucrum-media-company-spolka-z-ograniczona-odpowiedzialnoscia.outseta.com',
    load: 'auth,customForm,emailList,leadCapture,nocode,profile,support'
  };
</script>
<script src="https://cdn.outseta.com/outseta.min.js" data-options="o_options"></script>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>CIS Aurora ‚Äî AntyScam (Local)</title>

<style>
  :root {
    color-scheme: dark;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 32px;
    background: #0e0f13;
    color: #e6e7ea;
  }

  .wrap { max-width: 900px; margin: auto; }

  h1 { margin-bottom: 8px; }

  .card {
    border: 1px solid #2a2e37;
    border-radius: 12px;
    padding: 16px;
    margin-top: 16px;
    background: #141720;
    box-shadow: 0 2px 10px rgba(0, 0, 0, .4);
  }

  input[type=text] {
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #2a2e37;
    background: #0f1220;
    color: #e6e7ea;
  }

  button {
    padding: 10px 16px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease-in-out;
  }

  button.primary {
    background: #1f2330;
    color: #e6e7ea;
  }

  button.primary:hover {
    background: #2b3242;
  }

  pre {
    white-space: pre-wrap;
    background: #0f1220;
    padding: 12px;
    border-radius: 8px;
    max-height: 480px;
    overflow: auto;
    color: #e6e7ea;
  }

  .muted { color: #9aa0a6; font-size: 14px; }

  .row { display: flex; gap: 8px; margin-top: 8px; }
</style>
</head>

<body>
  <div class="wrap">
    <h1>üß† CIS Aurora ‚Äî AntyScam (Local)</h1>
    <p class="muted">Wklej adres kontraktu ETH, uruchom analizƒô i zobacz wynik. Serwer: Flask (port 5000).</p>

    <div class="card">
      <form id="form">
        <label>Adres kontraktu (0x...):</label>
        <input id="address" type="text" placeholder="0x0000000000000000000000000000000000000000" />
        <div class="row">
          <button class="primary" type="submit">Analizuj</button>
          <button type="button" id="btnLast">Poka≈º ostatni raport</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h3>Wynik</h3>
      <div id="overlayHTML" class="card" style="border:none;padding:0;margin:0 0 8px 0"></div>
      <pre id="result" style="display:none;margin-top:12px">‚Äî</pre>
    </div>
  </div>

  <script>
    const form = document.getElementById("form");
    const resBox = document.getElementById("result");
    const lastBtn = document.getElementById("btnLast");
    const htmlBox = document.getElementById("overlayHTML");

    async function fetchOverlayHTML() {
      try {
        const r = await fetch("/last-report-html");
        const txt = await r.text();
        htmlBox.innerHTML = (r.ok ? txt : `<pre>${txt}</pre>`);
      } catch (e) {
        htmlBox.innerHTML = `<pre>${String(e)}</pre>`;
      }
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      htmlBox.innerHTML = "<div style='padding:12px;color:#9aa0a6'>‚è≥ Analiza w toku‚Ä¶</div>";
      const addr = document.getElementById("address").value.trim();

      const resp = await fetch("/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/x-www-form-urlencoded" },
        body: new URLSearchParams({ address: addr })
      });

      try {
        const data = await resp.json();
        if (resBox) {
          let txt = data.error
            ? ("‚ùå " + data.error)
            : `Status: ${data.status}\nCzas: ${data.elapsed_sec}s\nAdres: ${data.address}\nCmd: ${data.cmd}\n\nSTDOUT (tail):\n${data.stdout_tail || ""}\n\nSTDERR (tail):\n${data.stderr_tail || ""}`;
          if (data.last_report) txt += `\n\nOstatni raport: ${data.last_report}`;
          resBox.textContent = txt;
        }
      } catch(_) {}

      fetchOverlayHTML();
    });

    lastBtn.addEventListener("click", async () => {
      if (resBox) resBox.textContent = "";
      fetchOverlayHTML();
    });

    fetchOverlayHTML();
  </script>
</body>
</html>
